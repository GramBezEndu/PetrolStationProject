@model List<PetrolStation.Models.ModelePomocnicze.ExtendedTransactionModel>


@{
    ViewData["Title"] = "Index";
}

<h1>Transactions</h1>
<select id="TypeList">
    <option>Transaction</option>
    <option>Transaction Invoice</option>
    <option>All</option>
</select>
<table class="table" id="MainTable">
    <thead>
        <tr>
            <th scope="col"></th>
            <th scope="col">Id transaction</th>
            <th scope="col">Client</th>
            <th scope="col">Transaction date</th>
            <th scope="col">Transaction sum</th>
            <th scope="col">Transaction type</th>
        </tr>
        @foreach (var extendedTransaction in Model)
        {
            <tr>
                <td>
                    <button class="DetailsButton">></button>
                </td>
                <td>
                    @Html.DisplayFor(modelItem => extendedTransaction.Transaction.IdTransaction)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => extendedTransaction.ClientString)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => extendedTransaction.Transaction.Date)
                </td>
                <td>
                    Not calculated
                </td>
                <td>
                    @Html.DisplayFor(modelItem => extendedTransaction.TransactionType)
                </td>
            </tr>
        }
        </thead>
    <tbody>
        @foreach (var extendedTransaction in Model)
        {
            <tr>
                @*Fueling list*@
                @if (extendedTransaction.FuelingList.Count > 0)
                {
                    <td colspan="6">
                        <h4>Fueling list</h4>
                        <table>
                            <tr>
                                <th scope="col">Id fueling</th>
                                <th scope="col">Id gas pump</th>
                                <th scope="col">Fuel name</th>
                                <th scope="col">Price per liter</th>
                                <th scope="col">Fuel quantity</th>
                                <th scope="col">Price total</th>
                            </tr>
                            @foreach (var fueling in extendedTransaction.FuelingList)
                            {
                                //Zastanowic sie czy tak chcemy zaokraglac
                                decimal priceTotal = Math.Round(fueling.Fueling.Fuel.PriceForLiter * (decimal)(fueling.Fueling.Quantity), 2);
                                <tr @*hidden*@>
                                    <td>
                                        @Html.DisplayFor(modelItem => fueling.IdFueling)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => fueling.Fueling.IdGasPump)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => fueling.Fueling.Fuel.Name)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => fueling.Fueling.Fuel.PriceForLiter)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => fueling.Fueling.Quantity)
                                    </td>
                                    <td>
                                        @priceTotal
                                    </td>
                                </tr>
                            }
                        </table>
                    </td>
                }
            </tr>
            <tr>
                @*Product list*@
                @if (extendedTransaction.PurchasedProducts.Count > 0)
                {
                    <td colspan="6">
                        <h4>Products list</h4>
                        <table>
                            <tr>
                                <th scope="col">Id product</th>
                                <th scope="col">Name</th>
                                <th scope="col">Price per unit</th>
                                <th scope="col">Quantity</th>
                                <th scope="col">Price sum</th>
                            </tr>
                            @foreach (var product in extendedTransaction.PurchasedProducts)
                            {
                                decimal priceSum = product.Quantity * product.Product.Price;
                                <tr @*hidden*@>
                                    <td>
                                        @Html.DisplayFor(modelItem => product.IdProduct)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => product.Product.Name)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => product.Product.Price)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => product.Quantity)
                                    </td>
                                    <td>
                                        @priceSum
                                    </td>
                                </tr>
                            }
                        </table>
                    </td>
                }
            </tr>
            <tr>
                @if (extendedTransaction.LoyalityCard != null)
                {
                    <td colspan="6">
                        <table>
                            <tr>
                                <th scope="col">Card ID</th>
                                <th scope="col">Owner ID</th>
                                <th scope="col">Points on card</th>
                            </tr>
                            <tr>
                                <td @*hidden*@>
                                    @Html.DisplayFor(modelItem => extendedTransaction.LoyalityCard.IdLoyalityCard)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => extendedTransaction.LoyalityCardOwner.IdClient)
                                </td>
                                <td @*hidden*@>
                                    @Html.DisplayFor(modelItem => extendedTransaction.LoyalityCard.ActualPoints)
                                </td>
                            </tr>
                        </table>
                    </td>
                }
            </tr>
        }
    </tbody>
</table>
<script>
    var table = document.getElementById("MainTable");
    var detailsButtons = document.getElementsByClassName("DetailsButton");
</script>
